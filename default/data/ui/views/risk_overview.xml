<form>
  <label>Risk Overview</label>
  <fieldset submitButton="true" autoRun="true">
    <input type="time" token="timerange" searchWhenChanged="true">
      <label>Time Range:</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="risk_object_type_token" searchWhenChanged="true">
      <label>Risk Object Type:</label>
      <search>
        <query>| tstats count from datamodel="risk_manager" groupby All_Risks_Events.risk_object_type</query>
      </search>
      <fieldForLabel>All_Risks_Events.risk_object_type</fieldForLabel>
      <fieldForValue>All_Risks_Events.risk_object_type</fieldForValue>
      <default>*</default>
      <choice value="*">All</choice>
    </input>
    <input type="dropdown" token="risk_object_token" searchWhenChanged="true">
      <label>Risk Object:</label>
      <search>
        <query>| tstats count from datamodel="risk_manager" groupby All_Risks_Events.risk_object, All_Risks_Events.risk_object_type | search All_Risks_Events.risk_object_type="*"</query>
        <earliest>0</earliest>
        <latest></latest>
      </search>
      <fieldForLabel>All_Risks_Events.risk_object</fieldForLabel>
      <fieldForValue>All_Risks_Events.risk_object</fieldForValue>
      <choice value="*">All</choice>
      <default>*</default>
    </input>
    <input type="dropdown" token="alert_token">
      <label>Alert Search:</label>
      <choice value="*">All</choice>
      <search>
        <query>| tstats count from datamodel="risk_manager" groupby All_Risks_Events.alert</query>
      </search>
      <fieldForLabel>All_Risks_Events.alert</fieldForLabel>
      <fieldForValue>All_Risks_Events.alert</fieldForValue>
      <default>*</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <single id="sv_risk_objects">
        <search>
          <query>| pivot risk_manager All_Risks_Events count(All_Risks_Events) AS value SPLITROW _time AS _time PERIOD auto FILTER risk_object is "$risk_object_token$" FILTER risk_object_type is "$risk_object_type_token$" FILTER alert is "$alert_token$"</query>
          <earliest>$timerange.earliest$</earliest>
          <latest>$timerange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="field">value</option>
        <option name="trendField">trend</option>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x156877","0x156877"]</option>
        <option name="rangeValues">[0]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">auto</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <option name="linkView">search</option>
        <option name="underLabel">Risk Objects</option>
      </single>
      <single id="sv_risk_score">
        <search>
          <query>| pivot risk_manager All_Risks_Events avg(risk_score) AS value SPLITROW _time AS _time PERIOD auto FILTER risk_object is "$risk_object_token$" FILTER risk_object_type is "$risk_object_type_token$" FILTER alert is "$alert_token$"</query>
          <earliest>$timerange.earliest$</earliest>
          <latest>$timerange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="field">value</option>
        <option name="trendField">trend</option>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x2B7D8C","0x2B7D8C"]</option>
        <option name="rangeValues">[0]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">auto</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <option name="linkView">search</option>
        <option name="underLabel">Average Risk Score</option>
      </single>
      <single id="sv_total_risk_score">
        <search>
          <query>| pivot risk_manager All_Risks_Events sum(risk_score) AS value SPLITROW _time AS _time PERIOD auto FILTER risk_object is "$risk_object_token$" FILTER risk_object_type is "$risk_object_type_token$" FILTER alert is "$alert_token$"</query>
          <earliest>$timerange.earliest$</earliest>
          <latest>$timerange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="field">value</option>
        <option name="trendField">trend</option>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x6EB3C0","0x6EB3C0"]</option>
        <option name="rangeValues">[0]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">auto</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <option name="linkView">search</option>
        <option name="underLabel">Total Risk Score</option>
      </single>
      <single id="sv_alert_searches">
        <search>
          <query>| pivot risk_manager All_Risks_Events dc(alert) AS value SPLITROW _time AS _time PERIOD auto FILTER risk_object is "$risk_object_token$" FILTER risk_object_type is "$risk_object_type_token$" FILTER alert is "$alert_token$"</query>
          <earliest>$timerange.earliest$</earliest>
          <latest>$timerange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="field">value</option>
        <option name="trendField">trend</option>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0xA4D6DF","0xA4D6DF"]</option>
        <option name="rangeValues">[0]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">auto</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <option name="linkView">search</option>
        <option name="underLabel">Alert Searches</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Current Risk Objects - Top 10</title>
        <search>
          <query>|inputlookup risks |stats max(risk_score) as risk_score by risk_object_type, risk_object |search risk_object_type="$risk_object_type_token$" | sort 10 -risk_score</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="count">10</option>
        <option name="link.visible">false</option>
        <drilldown>
          <link>/app/risk_manager/risk_search?form.risk_object_token=$row.risk_object$&amp;form.risk_object_type_token=$row.risk_object_type$</link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Current Risk Events - Top 10</title>
        <search>
          <query>[|inputlookup risks |stats max(risk_score) as risk_score by risk_object_type, risk_object |fields risk_object ] index=risks |stats sparkline count by risk_object_type, risk_object |search risk_object_type="$risk_object_type_token$" |rename sparkline as trend  |sort 10 -count</query>
          <earliest>$timerange.earliest$</earliest>
          <latest>$timerange.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="count">10</option>
        <option name="link.visible">false</option>
        <drilldown>
          <link>/app/risk_manager/risk_search?form.risk_object_token=$row.risk_object$&amp;form.risk_object_type_token=$row.risk_object_type$</link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>